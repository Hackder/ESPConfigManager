const char* IndexPage = R"=====(
<!doctype html><html lang=en><meta charset=UTF-8><meta content="width=device-width,initial-scale=1.0" name=viewport><title>ESP Config Manager</title><link href=https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css rel=stylesheet><link href=https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.colors.min.css rel=stylesheet><link href=https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.css rel=stylesheet><style>html,body{height:100%;margin:0;overflow:hidden}#app{width:100%;height:100%}.split-container{flex-direction:column;width:100%;height:100%;display:flex}.pane-config{background-color:var(--pico-background-color);padding:1rem;overflow-y:auto}.pane-logs{background-color:var(--pico-card-background-color);color:var(--pico-color);border-top:1px solid var(--pico-muted-border-color);flex-direction:column;font-family:Menlo,Monaco,Courier New,monospace;font-size:.85rem;display:flex;overflow:hidden}.log-header{background-color:var(--pico-card-sectioning-background-color);border-bottom:1px solid var(--pico-muted-border-color);flex-shrink:0;justify-content:space-between;align-items:center;padding:.5rem 1rem;display:flex}.log-header h3{color:var(--pico-color);margin:0;font-size:1rem}.log-controls button{width:auto;margin-left:.5rem;padding:.2rem .5rem;font-size:.75rem;display:inline-block}.log-list{scroll-behavior:smooth;flex:1;padding:.5rem 1rem;overflow-y:auto}.log-entry{white-space:pre-wrap;word-break:break-all;border-bottom:1px solid var(--pico-muted-border-color);margin-bottom:.2rem;padding-bottom:.2rem;line-height:1.4}.log-entry:last-child{border-bottom:none}.log-timestamp{color:var(--pico-muted-color);margin-right:.5rem}.resizer{background-color:var(--pico-muted-border-color);z-index:10;transition:background-color .2s;display:none}@media (width>=768px){.split-container{flex-direction:row}.pane-config{height:100%}.pane-logs{border-top:none;border-left:1px solid var(--pico-muted-border-color);flex:1;height:100%}.resizer{cursor:col-resize;z-index:20;background-color:#0000;width:6px;height:100%;margin:0 -3px;display:block;position:relative}.resizer:after{content:"";background-color:var(--pico-muted-border-color);width:2px;position:absolute;top:0;bottom:0;left:2px}.resizer:hover:after,.resizer.active:after{background-color:var(--pico-primary)}}@media (width<=767px){html,body{overflow:auto}.split-container{height:auto;display:block}.pane-config{height:auto;overflow:visible;width:100%!important}.pane-logs{height:500px;width:100%!important}}.loading-overlay{color:#fff;z-index:1000;background:#00000080;justify-content:center;align-items:center;display:flex;position:fixed;inset:0}</style><body><div id=app></div><script src=https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.js></script><script type=module>import{h,render,Fragment}from"https://esm.sh/preact";import{useState,useEffect,useRef,useCallback}from"https://esm.sh/preact/hooks";const baseUrl=window.location.protocol===`file:`?`http://192.168.88.179`:``,notyf=new Notyf({position:{x:`right`,y:`top`}});
// --- Components ---
function ButtonField({field,config,setConfig}){let[loading,setLoading]=useState(!1);async function handleClick(){setLoading(!0);try{let resp=await fetch(baseUrl+`/event`,{method:`POST`,headers:{"Content-Type":`application/json`},body:JSON.stringify({name:field.name,event:`click`,config:config.reduce((acc,field)=>(acc[field.name]=field.value,acc),{})})});resp.ok?(setConfig(await resp.json()),notyf.success(`Event sent successfully`)):notyf.error(`Failed to send event`)}catch(e){notyf.error(`Error sending event: `+e.message)}finally{setLoading(!1)}}let title=field.options.title||field.name;return h(`button`,{type:`button`,onclick:handleClick,ariaBusy:loading,disabled:loading},title)}function Field({field,config,setConfig,change}){if(field.type===`button`)return h(ButtonField,{field,config,setConfig});if(field.type===`int`||field.type===`float`){let hasRange=field.options.min!==void 0&&field.options.max!==void 0,hasSlider=hasRange&&!field.options.hide_slider,numericChange=valStr=>{let value;value=field.type===`int`?parseInt(valStr):parseFloat(valStr),!isNaN(value)&&value!==field.value&&change(value)};return h(`label`,null,field.options.title||field.name,hasRange&&h(`small`,{class:`pico-color-grey-500`},` (${field.options.min} - ${field.options.max})`),h(`input`,{type:`number`,name:field.name,min:field.options.min,max:field.options.max,step:field.options.step,value:field.value,style:hasSlider?`margin-bottom: 0`:``,oninput:e=>numericChange(e.target.value)}),hasSlider&&h(`input`,{type:`range`,name:field.name,min:field.options.min,max:field.options.max,step:field.options.step,value:field.value,style:`margin-bottom: var(--pico-spacing)`,oninput:e=>numericChange(e.target.value)}),h(`small`,null,field.options.description))}return field.type===`string`?h(`label`,null,field.options.title||field.name,h(`input`,{type:`text`,name:field.name,value:field.value,oninput:e=>change(e.target.value)}),h(`small`,null,field.options.description)):field.type===`bool`?h(`fieldset`,null,h(`label`,null,h(`input`,{type:`checkbox`,name:field.name,role:`switch`,checked:field.value,onchange:e=>change(e.target.checked)}),field.options.title||field.name,h(`small`,{style:`display: block; margin-top: 0.2em; color: var(--pico-muted-color)`},field.options.description))):h(`div`,null,`Unknown field type: `,field.type)}function ConfigPane(){let[config,setConfig]=useState(null),[loading,setLoading]=useState(!0);useEffect(()=>{async function fetchData(){try{let response=await fetch(baseUrl+`/config`);if(!response.ok)throw Error(`Failed to load config`);setConfig(await response.json())}catch(e){notyf.error(e.message)}finally{setLoading(!1)}}fetchData()},[]);let handleChange=useCallback((index,value)=>{setConfig(prevConfig=>{let newConfig=[...prevConfig];return newConfig[index]={...newConfig[index],value},newConfig})},[]);return loading?h(`div`,{class:`loading-overlay`},h(`h2`,null,`Loading Configuration...`)):h(Fragment,null,h(`hgroup`,null,h(`h1`,null,`Configuration`),h(`p`,null,`Manage your ESP device settings`)),config?h(`form`,{onsubmit:e=>e.preventDefault()},config.map((field,index)=>h(Field,{field,config,setConfig,change:value=>handleChange(index,value)}))):h(`p`,null,`No configuration loaded.`))}function LogViewer(){let[logs,setLogs]=useState([]),listRef=useRef(null),[autoScroll,setAutoScroll]=useState(!0);
// Auto-scroll logic
useEffect(()=>{let es=new EventSource(baseUrl+`/logs`),buffer=[];es.onmessage=e=>{buffer.push({msg:e.data,time:(/* @__PURE__ */ new Date()).toLocaleTimeString()})},es.onerror=e=>{
// console.error("EventSource failed:", e);
};let interval=setInterval(()=>{buffer.length>0&&setLogs(prev=>{let newLogs=[...prev,...buffer];return buffer=[],newLogs.slice(-1e3)})},200);return()=>{es.close(),clearInterval(interval)}},[]),useEffect(()=>{if(autoScroll&&listRef.current){let el=listRef.current;requestAnimationFrame(()=>{el.scrollTop=el.scrollHeight})}},[logs,autoScroll]);let handleScroll=()=>{if(!listRef.current)return;let{scrollTop,scrollHeight,clientHeight}=listRef.current,isAtBottom=scrollHeight-scrollTop-clientHeight<50;!isAtBottom&&autoScroll?setAutoScroll(!1):isAtBottom&&!autoScroll&&setAutoScroll(!0)};return h(`div`,{class:`pane-logs`},h(`div`,{class:`log-header`},h(`h3`,null,`Device Logs`),h(`div`,{class:`log-controls`},h(`button`,{class:`outline contrast`,onclick:()=>setAutoScroll(!autoScroll)},autoScroll?`Auto-scroll: ON`:`Auto-scroll: OFF`),h(`button`,{class:`outline secondary`,onclick:()=>setLogs([])},`Clear`))),h(`div`,{class:`log-list`,ref:listRef,onscroll:handleScroll},logs.length===0&&h(`div`,{style:`color: var(--pico-muted-color); text-align: center; padding: 2rem;`},`Waiting for logs...`),logs.map((log,i)=>h(`div`,{key:i,class:`log-entry`},h(`span`,{class:`log-timestamp`},log.time),log.msg))))}function App(){let[leftWidth,setLeftWidth]=useState(50),[isResizing,setIsResizing]=useState(!1),startResizing=useCallback(e=>{e.preventDefault(),setIsResizing(!0)},[]);return useEffect(()=>{if(!isResizing)return;let onMouseMove=e=>{let newWidth=e.clientX/window.innerWidth*100;newWidth>20&&newWidth<80&&setLeftWidth(newWidth)},onMouseUp=()=>{setIsResizing(!1)};return window.addEventListener(`mousemove`,onMouseMove),window.addEventListener(`mouseup`,onMouseUp),()=>{window.removeEventListener(`mousemove`,onMouseMove),window.removeEventListener(`mouseup`,onMouseUp)}},[isResizing]),h(`div`,{class:`split-container`},h(`div`,{class:`pane-config`,style:`width: ${leftWidth}%`},h(ConfigPane,null)),h(`div`,{class:`resizer ${isResizing?`active`:``}`,onmousedown:startResizing}),h(LogViewer,null))}render(h(App,null),document.getElementById(`app`));</script>
)=====";